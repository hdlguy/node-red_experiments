
# Use official Node-RED base image (based on Node.js LTS)
FROM nodered/node-red:latest

# create an environment variable to point to the compiled C commands
ENV C_BIN_PATH=/usr/src/node-red/c_code

# Copy your Node-RED flow
COPY flows/flows.json /data/flows.json
#COPY flows/settings.js /data/settings.js

# Copy C command and compile
RUN cd && mkdir c_code
COPY c_code/json_gen.c c_code/json_gen.c
COPY c_code/Makefile c_code/Makefile
RUN cd c_code && make clean && make && cd

# Install Dashboard 2.0 into Node-Red
RUN npm install --unsafe-perm --no-update-notifier --no-fund --only=production @flowfuse/node-red-dashboard@latest



